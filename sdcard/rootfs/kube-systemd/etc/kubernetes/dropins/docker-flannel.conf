[Unit]
After=flannel.service

[Service]
Type=notify
EnvironmentFile=/var/lib/kubernetes/flannel/subnet.env
EnvironmentFile=/etc/kubernetes/k8s.conf
ExecStartPre=-/etc/kubernetes/docker/bridge.sh docker0 destroy
ExecStartPre=-/etc/kubernetes/docker/bridge.sh docker0 create ${FLANNEL_SUBNET}
ExecStart=
ExecStart=/usr/bin/docker daemon \
    --host=unix:///var/run/docker.sock \
    --storage-driver=${DOCKER_STORAGE_DRIVER} \
    --bridge=docker0 \
    --mtu=${FLANNEL_MTU} \
    --insecure-registry=registry.kube-system.svc.cluster.local:5000 \
    --insecure-registry=10.0.0.20:5000 \
    --insecure-registry=registry.kube-system:5000 \
    --exec-opt native.cgroupdriver=cgroupfs
Restart=on-failure
RestartSec=2
MountFlags=
MountFlags=shared
